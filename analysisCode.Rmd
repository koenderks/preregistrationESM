---
title: "Preregistration ESM analysis code"
author: "Anu Hiekkaranta & Koen Derks"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 5
    number_sections: true
    df_print: paged
---

In this document we will describe the planned analyses for the experiment. To illustrate these analyses we will use an example data set, which is to be replaced when data collection has ended.

```{r document options, echo = F}
# First we set some global document options so as that messages from R are not shown in the output
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      fig.align = "center", 
                      fig.width = 10)
```

```{r setup options}

# Clear the workspace
rm(list=ls())

# Load the required packages
library(lme4)		        # For frequentist hierarchical modeling
library(lmerTest)	      # For testing effect in lme4
library(brms) 	        # For Bayesian hierarchical modeling
library(bayesplot)	    # For plotting the samples
library(viridis)
library(ggmcmc)
library(ggthemes)
library(ggridges)
library(gridExtra)
library(mcmcplots)
library(car)

# Set a global seed to make the results reproducible
seed <- 120495

# Specify the algorithmic options for `lme4`
ctrl <- lme4::lmerControl(optimizer = "optimx", calc.derivs = FALSE,
                          optCtrl = list(method = "nlminb", starttests = FALSE, kkt = FALSE))

# Specify the algorithmic options for `brms`
warmup          <- 200           # Number of samples to discard before saving
iterations      <- 1000          # Number of total samples
chains          <- 4             # Number of individual sampling chains
cores           <- 4             # Number of CPU cores to use
max_treedepth   <- 10            # Maximum allowed tree depth
adapt_delta     <- 0.999         # Target acceptance rate of samples

# Helper functions for data manipulation and plotting
.scaleNumericData <- function(x, center = TRUE, scale = TRUE) {
  if (nrow(x) == 0)
    return(x)
  idx <- sapply(x, is.numeric)
  x[, idx] <- scale(x[, idx, drop = FALSE], center, scale)
  attr(x, which = "scaled:center") <- NULL
  attr(x, which = "scaled:scale")  <- NULL
  return(x)
}

.plotPosteriorModelPP <- function(fit, title, xmin, xmax, color){
  sumFixed <- summary(fit)$fixed
  p <- ggplot(filter(ggs(fit), Parameter == "b_PP", Iteration > warmup), aes(x = value)) +
      geom_segment(x = 0, xend = 0, y = Inf, yend = 0, col = "red") +
      geom_segment(x = sumFixed[2,1], xend = sumFixed[2,1], 
                   y = Inf, yend = 0, col = "blue") +
      geom_segment(x = sumFixed[2,3], xend = sumFixed[2,3], 
                   y = Inf, yend = 0, col = "blue", linetype = 2) +
      geom_segment(x = sumFixed[2,4], xend = sumFixed[2,4], 
                         y = Inf, yend = 0, col = "blue", linetype = 2) +
      geom_density(fill  = color, alpha = .05) +
      scale_x_continuous(name = "Value", limits = c(xmin, xmax), breaks = pretty(c(xmin, xmax, 0))) + 
      scale_y_continuous(name = "Density") +
      labs(title = title) +
      geom_segment(x = xmin, xend = xmax, y = -Inf, yend = -Inf) +
      geom_segment(x = -Inf, xend = -Inf, y = 0, yend = 20) +
      theme_minimal() +
      theme(panel.grid = element_blank(), axis.ticks = element_line())
  return(p)
}

.plotPosteriorModelSD <- function(fit, var, title, xmin, xmax, color){
  parName <- paste0("sd_ID__", var)
  sumRandom <- summary(fit)$random$ID
  p <- ggplot(filter(ggs(fit), Parameter == parName, Iteration > warmup), aes(x = value)) +
      geom_segment(x = 0, xend = 0, y = Inf, yend = 0, col = "red") +
      geom_segment(x = sumRandom[2,1], xend = sumRandom[2,1], 
                   y = Inf, yend = 0, col = "blue") +
      geom_segment(x = sumRandom[2,3], xend = sumRandom[2,3], 
                   y = Inf, yend = 0, col = "blue", linetype = 2) +
      geom_segment(x = sumRandom[2,4], xend = sumRandom[2,4], 
                         y = Inf, yend = 0, col = "blue", linetype = 2) +
      geom_density(fill  = color, alpha = .05) +
      scale_x_continuous(name = "Value", limits = c(xmin, xmax), breaks = pretty(c(xmin, xmax, 0))) + 
      scale_y_continuous(name = "Density") +
      labs(title = title) +
      geom_segment(x = xmin, xend = xmax, y = -Inf, yend = -Inf) +
      geom_segment(x = -Inf, xend = -Inf, y = 0, yend = 20) +
      theme_minimal() +
      theme(panel.grid = element_blank(), axis.ticks = element_line())
  return(p)
}

.plotFixedCoefficients <- function(fit, title, xmin, xmax, warmup){
  mtfit <- ggs(fit)
  sumFixed <- summary(fit)$fixed
  plotData <- filter(mtfit, Parameter %in% c("b_Intercept", "b_PP","b_AGE", "b_GEN2", "b_INEG"), Iteration > warmup)
  plotData$Parameter <- factor(plotData$Parameter, levels = c("b_Intercept", "b_PP","b_AGE", "b_GEN2", "b_INEG"))
  p <- ggplot(plotData,
              aes(x = value, fill = Parameter)) +
              geom_density(alpha = .5) +
              labs(title = title) +
              geom_vline(xintercept = 0, col = "red", size = 1) +
              scale_x_continuous(name   = "Value", limits = c(xmin, xmax)) + 
              scale_y_continuous(name = "Density") +
              geom_segment(x = sumFixed[1,3], xend = sumFixed[1,3], y = 0, yend = Inf, col = "darkgreen", linetype = 2) +
              geom_segment(x = sumFixed[1,4], xend = sumFixed[1,4], y = 0, yend = Inf, col = "darkgreen", linetype = 2) +
              geom_segment(x = sumFixed[2,3], xend = sumFixed[2,3], y = 0, yend = Inf, col = "yellow", linetype = 2) +
              geom_segment(x = sumFixed[2,4], xend = sumFixed[2,4], y = 0, yend = Inf, col = "yellow", linetype = 2) +
              geom_segment(x = sumFixed[3,3], xend = sumFixed[3,3], y = 0, yend = Inf, col = "red", linetype = 2) +
              geom_segment(x = sumFixed[3,4], xend = sumFixed[3,4], y = 0, yend = Inf, col = "red", linetype = 2) +
              geom_segment(x = sumFixed[4,3], xend = sumFixed[4,3], y = 0, yend = Inf, col = "dodgerblue", linetype = 2) +
              geom_segment(x = sumFixed[4,4], xend = sumFixed[4,4], y = 0, yend = Inf, col = "dodgerblue", linetype = 2) +
              geom_segment(x = sumFixed[5,3], xend = sumFixed[5,3], y = 0, yend = Inf, col = "purple", linetype = 2) +
              geom_segment(x = sumFixed[5,4], xend = sumFixed[5,4], y = 0, yend = Inf, col = "purple", linetype = 2) +
              geom_segment(x = xmin, xend = xmax, y = -Inf, yend = -Inf) +
              geom_segment(x = -Inf, xend = -Inf, y = 0, yend = 20) +
              scale_fill_manual(name  = 'Parameters', 
                               values = c("darkgreen","yellow", "red", "dodgerblue", "purple"), 
                               labels = c(expression(gamma['00']), 
                                          expression(gamma['10']),  
                                          expression(gamma['20']),
                                          expression(gamma['30']),
                                          expression(gamma['40']))) +
            theme_minimal() +
      theme(panel.grid = element_blank(), axis.ticks = element_line())
  return(p)
}

# Apply the chosen seed globally
set.seed(seed)
```

# Inspecting the data

The data set contains the following variables:

- `ID`: The identification number of the participant,
- `INEG`: The intensity of daily negative events experienced by the participant,
- `IPOS`: The intensity of daily positive events experienced by the participant,
- `RUM`: The intensity of ruminating experienced by the participant,
- `SAV`: The intensity of savoring experienced by the participant,
- `SHAREN`: The intensity by which the participant shared negative events,
- `SHAREP`: The intensity by which the participant shared positive events,
- `PP`: The psychopathology score of the participant,
- `GEN`: The gender of the participant,
- `AGE`: The age of the participant.

```{r data}

# Start by reading in the data set
fulldata <- read.csv(file = "https://raw.githubusercontent.com/koenderks/preregistrationESM/master/CCP_pilot_resampled.csv", sep = ",")

# Select only the columns that are required for these analyses
fulldata <- fulldata[, c("ID", "INEG", "IPOS", "RUM", "SAV", "SHAREN", "SHAREP", "PP", "GEN", "AGE", "DAY")]

# Make factor variables for ID, DAY, and GEN
fulldata$ID   <- as.factor(fulldata$ID)
fulldata$DAY  <- as.factor(fulldata$DAY)
fulldata$GEN  <- as.factor(fulldata$GEN)

# Standardize the other numeric variables
fulldata <- .scaleNumericData(fulldata)

# Inspect the data set
head(fulldata)
```

# Hypotheses

The hypotheses for the experiment are the following:

- Hypothesis 1:  Sharing negative daily events is positively associated with psychopathology ($PP_{\uparrow} \rightarrow SHAREN_{\uparrow}$),
- Hypothesis 2:  Ruminating about daily negative events is positively associated with psychopathology ($PP_{\uparrow} \rightarrow RUM_{\uparrow}$),
- Hypothesis 3:  Sharing daily positive events is not associated with psychopathology ($PP_{\uparrow} \rightarrow SHAREP_{-}$),
- Hypothesis 4:  Savouring daily positive events is not associated with psychopathology ($PP_{\uparrow} \rightarrow SAV_{-}$),
- Hypothesis 5:  Intensity of daily negative events is positively associated with rumination ($INEG_{\uparrow} \rightarrow RUM_{\uparrow}$),
- Hypothesis 6:  Intensity of daily negative events is positively associated with sharing ($INEG_{\uparrow} \rightarrow SHAREN_{\uparrow}$),
- Hypothesis 7:  Intensity of daily positive events is positively associated with savouring ($IPOS_{\uparrow} \rightarrow SAV_{\uparrow}$),
- Hypothesis 8:  Intensity of daily positive events is positively associated with sharing ($IPOS_{\uparrow} \rightarrow SHAREP_{\uparrow}$),
- Hypothesis 9:  Psychopathology is positively associated with the intensity of daily negative events ($PP_{\uparrow} \rightarrow INEG_{\uparrow}$),
- Hypothesis 10: Psychopathology is not associated with the intensity of daily positive events ($PP_{\uparrow} \rightarrow IPOS_{-}$).


# Analyses

Below we will outline the six models we will use to find out to what degree the data contain support for any of the hypotheses.

## Model 1: Sharing negative events

- Hypothesis 1: Talking more about daily negative events is associated with lower psychopathology
- Hypothesis 6: Intensity of daily negative events is positively associated with sharing

The regression formula for this model is:

$$SHAREN_{ij} = \gamma_{00} + \gamma_{10} \cdot PP_{ij} + \gamma_{20} \cdot AGE_{ij} + \gamma_{30} \cdot GEN_{{M}_{ij}} + \gamma_{40} \times INEG_{ij} + u_{4j} \cdot INEG_{ij} + u_{0j} + \epsilon_{ij},$$

in which observation $i$ from participant $j$ is predicted by a population-level intercept and coefficients for $PP$, $AGE$, $GEN_M$ and $INEG$ and a person-level intercept and random coefficient for $INEG$.

```{r class.source = "fold-show"}

# Hypothesis 1: 
# Talking more about daily negative events is associated with lower psychopathology 
# -> Negative population effect (PP < 0).
#
# Hypothesis 6: 
# Intensity of daily negative events is positively associated with sharing 
# -> Positive population effect (INEG > 0).
# 
# Model:
# SHAREN ~ 1 + PP + AGE + GEN + INEG + (1 + INEG|ID)

model1f <- SHAREN ~ 1 + PP + AGE + INEG + (1 + INEG|ID)
model1b <- SHAREN ~ 0 + Intercept + PP + AGE + GEN + INEG + (1 + INEG|ID)
```

```{r}
# Remove NA values from the data set
dataset <- fulldata[!is.na(fulldata$INEG), ]
```

### Data visualization

First we visualize the data to get a better impression of the effects under investigation.

```{r}
p1 <- ggplot(data = dataset, aes(x = PP, y = SHAREN)) +
        geom_point(size = 1.2, alpha = 0.8, position = "jitter") +
        geom_smooth(method = lm, se = FALSE, size = .5, alpha = .8) +
        labs(title = "Linear Relationship for Sharing versus Intensity",
              subtitle = "The linear relationship is assumed to be equal across persons") +
        geom_segment(x = -3, xend = 3, y = -Inf, yend = -Inf, col = "black") +
        geom_segment(x = -Inf, xend = -Inf, y = -3, yend = 3, col = "black") +
        scale_y_continuous(name = "SHAREN", limits = c(-3, 3), breaks = pretty(c(-3, 3))) +
        scale_x_continuous(name = "PP", limits = c(-3, 3), breaks = pretty(c(-3, 3))) +
        theme_minimal() +
        theme(panel.grid = element_blank(), axis.ticks = element_line(), legend.position = "none")

p2 <- ggplot(data = dataset, aes(x = INEG, y = SHAREN, col = ID, group = ID)) +
        geom_point(size = 1.2, alpha = .8, position = "jitter") + 
        geom_smooth(method = lm, se = FALSE, size = .5, alpha = .8) +
        labs(title = "Linear Relationship for Different Persons as Observed",
              subtitle = "The linear relationship between the two is assumed to be different for all persons") +
        geom_segment(x = -3, xend = 3, y = -Inf, yend = -Inf, col = "black") +
        geom_segment(x = -Inf, xend = -Inf, y = -3, yend = 3, col = "black") +
        scale_y_continuous(name = "SHAREN", limits = c(-3, 3), breaks = pretty(c(-3, 3))) +
        scale_x_continuous(name = "INEG", limits = c(-3, 3), breaks = pretty(c(-3, 3))) +
        theme_minimal() +
        theme(panel.grid = element_blank(), axis.ticks = element_line())
grid.arrange(p1, p2, nrow = 1)
```

### Frequentist analysis

```{r}
fit1_f  <- lme4::lmer(formula = model1f, data = dataset, control = ctrl)
sum1_f  <- summary(fit1_f)
``` 

##### ANOVA test for fixed effects 

By assessing the fixed effects in the model we are able to say something about the main effects.

```{r}
test1_f <- car::Anova(fit1_f)
print(test1_f)
```
##### ANOVA test for removal of random effects

By removing the random effect from the model, we can inspect whether it produced a better fit.

```{r}
test1_f2 <- lmerTest::ranova(fit1_f)
print(test1_f2)
```

### Bayesian analysis

For the Bayesian analysis we use two different sets of priors.

The non-informative set of priors consists of:

$$\gamma_{00} \sim N(0, 10) \\
  \gamma_{10} \sim N(0, 10) \\
  \gamma_{20} \sim N(0, 10) \\ 
  \gamma_{30} \sim N(0, 10) \\
  \gamma_{40} \sim N(0, 10)$$

The informed set of priors consists of: 

$$\gamma_{00} \sim Cauchy(-0.48, 0.85) \\
  \gamma_{10} \sim N(-.26,.25) \\
  \gamma_{20} \sim N(-0.01, 0.05) \\ 
  \gamma_{30} \sim N(0.45,.12) \\
  \gamma_{40} \sim N(0, 10) \\
  \sigma_{u_{4j}} \sim N(0.48,.06)$$

```{r}

# Non-informative priors:
#
# b_Intercept ~ Normal(0,10)
# b_Age ~ Normal(0,10)
# b_PP ~ Normal(0,10)
# b_GEN2 ~ Normal(0,10)
# b_INEG ~ Normal(0, 10)

priorsni <- c(set_prior("normal(0,10)", class = "b", coef = "Intercept"),
            set_prior("normal(0,10)", class = "b", coef = "AGE"),
            set_prior("normal(0,10)", class = "b", coef = "PP"),
            set_prior("normal(0,10)", class = "b", coef = "GEN2"),
            set_prior("normal(0, 10)", class = "b", coef = "INEG"))

fit1_bni <- brms::brm(formula = model1b, 
                    data      = dataset, 
                    inits     = "random",
                    chains    = chains,
                    cores     = cores, 
                    prior     = priorsni,
                    warmup    = warmup, 
                    iter      = iterations,
                    seed      = seed,
                    sample_prior = TRUE,
                    control = list(adapt_delta = adapt_delta, 
                                   max_treedepth = max_treedepth),
                    save_pars = brms::save_pars(all = TRUE))

# Informed priors:
#
# b_Intercept ~ Cauchy(-0.48, 0.85)
# b_Age ~ Normal(-0.01, 0.05)
# b_PP ~ Normal(-.26,.25)
# b_GEN2 ~ Normal(0.45,.12)
# b_INEG ~ Normal(0, 10)
# sd_INEG_ID ~ Normal(0.48,.06)

priorsi <- c(set_prior("cauchy(-.48,.85)", class = "b", coef = "Intercept"),
            set_prior("normal(-.01, .05)", class = "b", coef = "AGE"),
            set_prior("normal(-.26,.25)", class = "b", coef = "PP"),
            set_prior("normal(0.45,.12)", class = "b", coef = "GEN2"),
            set_prior("normal(0, 10)", class = "b", coef = "INEG"),
            set_prior("normal(0.48,.06)", class = "sd", coef = "INEG", group = "ID"))

fit1_bi <- brms::brm(formula  = model1b, 
                     data     = dataset, 
                     inits    = "random",
                     chains   = chains,
                     cores    = cores, 
                     prior    = priorsi,
                     warmup   = warmup, 
                     iter     = iterations,
                     seed     = seed,
                     sample_prior = TRUE,
                     control = list(adapt_delta = adapt_delta, 
                                    max_treedepth = max_treedepth),
                     save_pars = brms::save_pars(all = TRUE))

```

#### Parameter estimates

##### Non-informative priors

```{r}
summary(fit1_bni)
```

```{r}
mcmc_plot(fit1_bni, type = "trace")
```

```{r}
mcmc_plot(fit1_bni, type = "hist")
```

```{r}
.plotFixedCoefficients(fit1_bni, title = "Posterior Density of Parameters With 95% CI lines", 
                        xmin = -10, xmax = 10, warmup = warmup)
```

##### Informed priors

```{r}
summary(fit1_bi, priors = TRUE)
```

```{r}
mcmc_plot(fit1_bi, type = "trace")
```

```{r}
mcmc_plot(fit1_bi, type = "hist")
```

```{r}
.plotFixedCoefficients(fit1_bi, title = "Posterior Density of Parameters With 95% CI lines", 
                        xmin = -2, xmax = 2, warmup = warmup)
```


#### Hypothesis tests

##### Hypothesis 1: $\gamma_{10}$ < 0

```{r}
hypothesis1_bni <- brms::hypothesis(fit1_bni, "PP < 0", class = "b")
hypothesis1_bi <- brms::hypothesis(fit1_bi, "PP < 0", class = "b")
tab <- data.frame("Priors" = c("Non-informative", "Informed"))
tab <- cbind(tab, rbind(hypothesis1_bni$hypothesis, hypothesis1_bi$hypothesis))
print(tab)
```


```{r}
p1 <- .plotPosteriorModelPP(fit1_bni, title = bquote("Posterior density for "*gamma[10]*" [Uninformed]"), 
                            xmin = -30, xmax = 30, color = "yellow")
p2 <- .plotPosteriorModelPP(fit1_bi, title = bquote("Posterior density for "*gamma[10]*" [Informed]"), 
                            xmin = -2, xmax = 2, color = "dodgerblue")
grid.arrange(p1, p2, nrow = 1)
```

```{r}
posterior1 <- posterior_samples(fit1_bni, pars = "b_PP")
posterior2 <- posterior_samples(fit1_bi, pars = "b_PP")

posterior1.2 <- bind_rows("prior 1" = gather(posterior1),
                            "prior 2" = gather(posterior2),
                            .id = "id")

p <- ggplot(data = posterior1.2,
      mapping = aes(x = value, fill = id, colour = key, linetype = key, alpha = key)) +
      geom_density(size = 0.8) +
      geom_vline(xintercept = summary(fit1_f)$coefficients["PP", "Estimate"],
                 size = .8, linetype = 2, col = "black") +
      scale_x_continuous(name = "Value", limits = c(-5, 5))+
      scale_y_continuous(name = "Density", limits = c(0, 3)) +
      coord_cartesian(ylim = c(0, 5))+
      scale_fill_manual(name   = "Densities",
                        values = c("yellow", "dodgerblue"),
                        labels = c("Non-informative ~ N(0, 10) prior",
                                    "Informative ~ N(-.26,.25) prior")) +
      scale_colour_manual(name   = 'Posterior/Prior',
                          values = c("black","red"),
                          labels = c("posterior", "prior"))+
      scale_linetype_manual(name   ='Posterior/Prior',
                        values = c("solid","dotted"),
                        labels = c("posterior", "prior"))+
      scale_alpha_discrete(name   = 'Posterior/Prior',
                       range  = c(.7,.3),
                       labels = c("posterior", "prior"))+
      annotate(geom    = "text",
                x = summary(fit1_f)$coefficients["PP", "Estimate"], y = 4,
           label  = paste0("LME estimate:  ",
                           round(summary(fit1_f)$coefficients["PP", "Estimate"], 3)),
           col    = "black",
           family = theme_get()$text[["family"]],
           size   = theme_get()$text[["size"]]/3.5,
           fontface="italic")+
      labs(title    = expression("Influence of (Informative) Priors on" ~ gamma[10]),
       subtitle = "2 different densities of priors and posteriors and the LME estimate") +
      geom_segment(x = -5, xend = 5, y = -Inf, yend = -Inf) +
      geom_segment(x = -Inf, xend = -Inf, y = 0, yend = 5) +
      theme_minimal() +
      theme(panel.grid = element_blank(), axis.ticks = element_line())
print(p)
```

##### Hypothesis 6: $\gamma_{40}$ > 0

```{r}
# hypothesis6_bni <- brms::hypothesis(fit1_bni, "INEG > 0", class = "sd", group = "ID")
# hypothesis6_bi <- brms::hypothesis(fit1_bi, "INEG > 0", class = "sd", group = "ID")
hypothesis6_bni <- brms::hypothesis(fit1_bni, "INEG > 0", class = "b")
hypothesis6_bi <- brms::hypothesis(fit1_bi, "INEG > 0", class = "b")
tab <- data.frame("Priors" = c("Non-informative", "Informed"))
tab <- cbind(tab, rbind(hypothesis6_bni$hypothesis, hypothesis6_bi$hypothesis))
print(tab)
```

```{r}
p1 <- .plotPosteriorModelSD(fit1_bni, var = "INEG", title = bquote("Posterior density for "*sigma['u4j']*" [Uninformed]"), 
                            xmin = -1, xmax = 3, color = "yellow")
p2 <- .plotPosteriorModelSD(fit1_bi, var = "INEG", title = bquote("Posterior density for "*sigma['u4j']*" [Informed]"), 
                            xmin = -1, xmax = 3, color = "dodgerblue")
grid.arrange(p1, p2, nrow = 1)
```

```{r}

samples <- posterior_samples(fit1_bi, pars = "INEG|ID")
samples <- as_tibble(t(samples[, 7:9]))

SHAREN <- dataset %>% group_by(ID) %>% summarise("SHAREN" = mean(SHAREN, na.rm = T))
SHAREN <- SHAREN[complete.cases(SHAREN), ]

plotdata <- cbind(SHAREN, samples) %>%
gather(key = "key", value = "value", -SHAREN, -ID) %>%
  group_by(ID) %>%
  mutate(meanperid = mean(value))%>%
  ungroup()

p <- ggplot() +
      geom_vline(xintercept = 0, col = "red") +
      ggridges::geom_density_ridges(data  = plotdata, 
                                    aes(x = value, y = reorder(as.factor(ID), meanperid), height = ..density.., 
                                        fill = ID, scale = 3, alpha = .6),
                                    scale = 3, 
                                    alpha = .6) +
      geom_point(data = summarise(group_by(plotdata, ID), meand = mean(meanperid)),
                  aes(x = meand, y = ID), col = "red") +
      scale_x_continuous(name = "Value", limits = c(-5, 10)) + 
      scale_y_discrete(name = "ID") +
      viridis::scale_fill_viridis(discrete = TRUE) +
      labs(title = expression(paste("ID Level Deviation of Regression Coefficient of INEG on SHARIN (", u["4j"],")")),
           subtitle = expression(paste("Posterior distribution of deviation of regression coefficient (", u["4j"],") per ID with the means in red"))) +
      annotate(geom = "text", x = 1.5, y = 0.5, label = "Grand mean", col = "red", family = theme_get()$text[["family"]], 
           size = theme_get()$text[["size"]]/3, fontface = "italic") +
      theme_minimal() +
      theme(panel.grid = element_blank(), axis.ticks = element_line())
print(p)
```

## Model 2: Sharing positive events

```{r specify model 2}
# Hypothesis 3: Talking more about daily positive events is not associated with psychopathology -> No population effect (PP = 0).
# Hypothesis 8: Intensity of daily positive events is positively associated with sharing -> Positive group effect (IPOS/ID > 0).

model2 <- SHAREN ~ 1 + PP + AGE + GEN + (1 + IPOS|ID)
```

### Frequentist analysis

```{r fit model 2}
# fit2_f <- lme4::lmer(formula = model2, data = dataset, control = ctrl)
# sum2_f <- summary(fit2_f)
# test2_f <- lmerTest::ranova(fit2_f)
```

## Model 3: Ruminating negative events

```{r specify model 3}
# Hypothesis 2: Ruminating more about daily negative events is associated with higher psychopathology -> Positive population effect (PP > 0).
# Hypothesis 5: Intensity of daily negative events is positively associated with rumination. -> Positive group effect (INEG/DAY > 0).

model3 <- RUM ~ 1 + PP + AGE + GEN + (1 + INEG|ID)
```

### Frequentist analysis

```{r fit model 3}
# fit3_f <- lme4::lmer(formula = model3, data = dataset, control = ctrl)
# sum3_f <- summary(fit3_f)
# test3_f <- lmerTest::ranova(fit3_f)
```

## Model 4: Savouring positive events

```{r specify model 4}
# Hypothesis 4: Savouring daily positive events is not associated with psychopathology. -> No population effect (PP = 0)
# Hypothesis 7: Intensity of daily positive events is positively associated with savouring. -> Positive group effect (IPOS/DAY > 0)

model4 <- SAV ~ 1 + PP + AGE + GEN + (1 + IPOS|ID)
```

### Frequentist analysis

```{r fit model 4}
# fit4_f <- lme4::lmer(formula = model4, data = dataset, control = ctrl)
# sum4_f <- summary(fit4_f)
# test4_f <- lmerTest::ranova(fit4_f)
```

## Model 5: Intensity negative events

```{r specify model 5}
# Hypothesis 9: Psychopathology is positively associated with the intensity of daily negative events. -> Positive population effect (PP > 0).

model5 <- INEG ~ 1 + PP + AGE + GEN
```

### Frequentist analysis

```{r fit model 5}
# fit5_f <- lme4::lmer(formula = model5, data = dataset, control = ctrl)
# sum5_f <- summary(fit5_f)
# test5_f <- lmerTest::ranova(fit5_f)
```

## Model 6: Intensity positive events

```{r specify model 6}
# Hypothesis 10: Psychopathology is not associated with the intensity of daily positive events. -> No population effect (PP = 0).

model6 <- IPOS ~ 1 + PP + AGE + GEN
```

### Frequentist analysis

```{r fit model 6}
# fit6_f <- lme4::lmer(formula = model6, data = dataset, control = ctrl)
# sum6_f <- summary(fit6_f)
# test6_f <- lmerTest::ranova(fit6_f)
```

# Results
